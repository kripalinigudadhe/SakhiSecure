<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ‚Äî Your Safety Overview & Live Map</title>
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-sA+MqZtO1CMu2R3crRMy2r0iGqgU4wJv+syH0u3g0jk=" crossorigin=""/>

<meta name="description" content="View your personalized safety dashboard with real-time alerts, location tracking, and community updates.">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<style>
/* ‚úÖ Flash message styling */
.flash-messages {
  max-width: 900px;
  margin: 2rem auto 0 auto;
  padding: 0 1rem;
}
.alert {
  padding: 12px;
  border-radius: 6px;
  margin-bottom: 1rem;
  font-weight: bold;
  text-align: center;
  font-size: 1rem;
}
.map-container {
    width: 100%;
    height: 350px;
    border-radius: 8px;
    overflow: hidden;
}
button.update-btn {
    background: var(--primary-pink, #e91e63);
    color: #fff;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s ease;
}

button.update-btn:hover {
    background: #d81b60; /* Slightly darker pink on hover */
}

.alert-success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}
.alert-error, .alert-danger {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}
</style>
</head>
<body>

<header>
    <nav>
        <a href="{{ url_for('index') }}" class="logo">
            SakhiSecure
            <img src="{{ url_for('static', filename='images/logo-removebg-preview.png') }}" alt="Logo" class="logo-img">
        </a>
        <ul class="nav-menu">
            <li><a href="{{ url_for('index') }}">Home</a></li>
            <li><a href="{{ url_for('dashboard') }}" class="nav-link active">Dashboard</a></li>
            <li><a href="{{ url_for('analytics') }}">Analytics</a></li>
            <li><a href="{{ url_for('report') }}">Report</a></li>
            <li><a href="{{ url_for('resources') }}">Resources</a></li>
            <li><a href="{{ url_for('about') }}">About</a></li>
            <li><a href="{{ url_for('login') }}">Login</a></li>
        </ul>
        <button class="mobile-toggle">‚ò∞</button>
    </nav>
    <style>
        .logo { display: flex; align-items: center; font-size: 2.2rem; font-weight: bold; color: #f3f0f2; text-decoration: none; margin-left: -60px; }
        .logo-img { width: 55px; height: 55px; margin-left: 6px; object-fit: contain; }
        nav a.logo:hover { opacity: 0.9; }
    </style>
</header>

<main>

<!-- ‚úÖ Flash message display (appears if redirected here after login) -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<section class="container" style="margin-top: 50px;">
    <div class="dashboard-header">
        <h1 style="color: var(--primary-pink); margin-bottom: 0.5rem;">Your Safety Dashboard</h1>
       <h1 style="color: var(--primary-pink); margin-bottom: 0.5rem;">
    Welcome, {{ user.fullname }}!
</h1>
<p style="color: var(--text-light);">
    Here's your safety overview and personal information:
</p>

<!-- <div style="margin-top: 2rem;">
    <h3>üìã Your Information:</h3>
    <ul>
        <li><strong>Full Name:</strong> {{ user.fullname }}</li>
        <li><strong>Date of Birth:</strong> {{ user.dob }}</li>
        <li><strong>Profession:</strong> {{ user.profession }}</li>
        <li><strong>Area:</strong> {{ user.area }}</li>
        <li><strong>City:</strong> {{ user.city }}</li>
        <li><strong>State:</strong> {{ user.state }}</li>
        <li><strong>Email:</strong> {{ user.email }}</li>
        <li><strong>Phone:</strong> {{ user.phone }}</li>
        <li><strong>Age:</strong> {{ user.age }}</li>
    </ul>
</div> -->

    </div>

  <div class="dashboard-stats">
    <!-- Active Alerts -->
    <div class="stat-card">
        <span class="stat-number" id="active-alerts">{{ stats.active_alerts }}</span>
        <span class="stat-label">Active Alerts Nearby</span>
        <button class="update-btn" onclick="openForm('active_alerts')">Update</button>
        <form id="form-active_alerts" class="stat-form" style="display:none;">
            <input type="number" name="value" placeholder="Enter new value" required>
            <button class="update-btn" type="submit">Submit</button>
        </form>
    </div>

    <!-- Verified Safe Zones -->
    <div class="stat-card">
        <span class="stat-number" id="safe-zones">{{ stats.safe_zones }}</span>
        <span class="stat-label">Verified Safe Zones</span>
        <button class="update-btn" onclick="openForm('safe_zones')">Update</button>
        <form id="form-safe_zones" class="stat-form" style="display:none;">
            <input type="number" name="value" placeholder="Enter new value" required>
            <button class="update-btn" type="submit">Submit</button>
        </form>
    </div>

    <!-- Community Reports Today -->
    <div class="stat-card">
        <span class="stat-number" id="community-reports">{{ stats.community_reports }}</span>
        <span class="stat-label">Community Reports Today</span>
        <button class="update-btn" onclick="openForm('community_reports')">Update</button>
        <form id="form-community_reports" class="stat-form" style="display:none;">
            <input type="number" name="value" placeholder="Enter new value" required>
            <button class="update-btn" type="submit">Submit</button>
        </form>
    </div>

    <!-- Avg Response Time -->
    <div class="stat-card">
        <span class="stat-number" id="avg-response-time">{{ stats.avg_response_time }}</span>
        <span class="stat-label">Avg Response Time</span>
        <button class="update-btn" onclick="openForm('avg_response_time')">Update</button>
        <form id="form-avg_response_time" class="stat-form" style="display:none;">
            <input type="text" name="value" placeholder="Enter new value (e.g., 3 min)" required>
            <button class="update-btn" type="submit">Submit</button>
        </form>
    </div>
</div>


    <div class="grid grid-2">
        <div class="card">
            <h3 style="color: var(--primary-pink); margin-bottom: 1rem;">üó∫Ô∏è Live Safety Map</h3>
          <div id="map" class="map-container"></div>
            <div style="margin-top: 1rem;">
                <a href="{{ url_for('predictive_analysis') }}" class="btn">Predictive Analysis</a>
                <a href="{{ url_for('analytics') }}" class="btn btn-secondary">Detailed Analytics</a>
            </div>
        </div>

        <div>
            <div class="card" style="margin-bottom: 1rem;">
                <h3 style="color: var(--primary-pink);">üö® Recent Alerts</h3>
                <div style="max-height: 300px; overflow-y: auto;">
                    <div class="alert alert-warning">
                        <strong>Caution:</strong> Increased activity reported near Central Park area
                        <br><small>2 minutes ago ‚Ä¢ 0.8 km away</small>
                    </div>
                    <div class="alert alert-info">
                        <strong>Community Alert:</strong> Well-lit, safe walking group forming at Metro Station
                        <br><small>15 minutes ago ‚Ä¢ 1.2 km away</small>
                    </div>
                    <div class="alert alert-success">
                        <strong>All Clear:</strong> Security patrol active in downtown business district
                        <br><small>1 hour ago ‚Ä¢ 0.5 km away</small>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--primary-pink);">‚ö° Quick Actions</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button class="btn">Check In Safe</button>
                    <button class="btn" style="background: #dc3545;">Emergency Alert</button>
                    <a href="{{ url_for('report') }}" class="btn btn-secondary">Report Incident</a>
                    <a href="{{ url_for('community') }}" class="btn btn-secondary">Community Chat</a>
                </div>
            </div>
        </div>
    </div>

    <section style="margin: 3rem 0;">
        <h2 style="color: var(--primary-pink); margin-bottom: 2rem;">Your Safety Insights</h2>
        <div class="grid grid-3">
            <div class="card">
                <h3>üìä This Week's Activity</h3>
                <div style="margin: 1rem 0;">
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Safe Check-ins:</span>
                        <strong>47</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Route Safety Score:</span>
                        <strong style="color: #28a745;">Excellent</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Community Interactions:</span>
                        <strong>12</strong>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üéØ Safety Goals</h3>
                <div style="margin: 1rem 0;">
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Daily Check-ins</span>
                            <span>6/8</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Safe Route Usage</span>
                            <span>9/10</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 90%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üë• Community Impact</h3>
                <div style="text-align: center; margin: 1rem 0;">
                    <div style="font-size: 2rem; color: var(--primary-pink); margin-bottom: 0.5rem;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p style="margin-bottom: 1rem;"><strong>Community Helper Status</strong></p>
                    <small style="color: var(--text-light);">You've helped 15 women this week through check-ins and safety tips</small>
                </div>
            </div>
        </div>
    </section>

    <section class="card" style="margin: 3rem 0;">
        <h2 style="color: var(--primary-pink); margin-bottom: 1rem;">Personalized Safety Recommendations</h2>
        <div class="grid grid-2">
            <div>
                <h4>üïê Today's Recommendations:</h4>
                <ul style="margin: 1rem 0;">
                    <li>Best time to travel home: <strong>Before 8:00 PM</strong></li>
                    <li>Safest route to office: <strong>Main Street (87% safety score)</strong></li>
                    <li>Community buddy available: <strong>Sarah M. (0.3 km away)</strong></li>
                    <li>Well-lit parking spots: <strong>3 available near destination</strong></li>
                </ul>
            </div>
            <div>
                <h4>‚ö†Ô∏è Areas to Avoid Today:</h4>
                <ul style="margin: 1rem 0;">
                    <li>Oak Avenue (construction zone - poor lighting)</li>
                    <li>Central Park east entrance (incident reported)</li>
                    <li>5th Street after 7 PM (low community activity)</li>
                </ul>
            </div>
        </div>
    </section>
</section>
<section class="hero">
  <div class="container">
    <h1>Emotion Journal</h1>
    <p>
      Express your daily feelings and experiences safely. Our AI-powered journal
      helps you understand emotional trends, track mental well-being, and receive
      personalized advice to stay balanced and confident.
    </p>
   <a href="{{ url_for('emotion_journal') }}" class="btn">Emotion Journal</a>

  </div>
</section>

<a href="{{ url_for('alert') }}" class="emergency-btn" title="Emergency Alert">üö®</a>
<footer>
    <div class="footer-content">
        <div class="footer-grid">
            <div class="footer-section">
                <h3>Safety Resources</h3>
                <ul>
                    <li><a href="{{ url_for('resources') }}">Emergency Contacts</a></li>
                    <li><a href="{{ url_for('prevention') }}">Prevention Tips</a></li>
                    <li><a href="{{ url_for('faq') }}">FAQ</a></li>
                    <li><a href="{{ url_for('news') }}">Safety News</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Platform</h3>
                <ul>
                    <li><a href="{{ url_for('features') }}">Features</a></li>
                    <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                    <li><a href="{{ url_for('analytics') }}">Analytics</a></li>
                    <li><a href="{{ url_for('report') }}">Report Incident</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Community</h3>
                <ul>
                    <li><a href="{{ url_for('community') }}">Local Alerts</a></li>
                    <li><a href="{{ url_for('volunteer') }}">Volunteer</a></li>
                    <li><a href="{{ url_for('partners') }}">Partners</a></li>
                    <li><a href="{{ url_for('contact') }}">Contact Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Legal</h3>
                <ul>
                    <li><a href="{{ url_for('privacy') }}">Privacy Policy</a></li>
                    <li><a href="{{ url_for('terms') }}">Terms of Service</a></li>
                    <li><a href="{{ url_for('about') }}">About Us</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 SakhiSecure. All rights reserved. | Protecting women through technology.</p>
        </div>
    </div>
</footer>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
function openForm(stat) {
    const form = document.getElementById('form-' + stat);
    form.style.display = form.style.display === 'none' ? 'block' : 'none';

    form.onsubmit = async function(e) {
        e.preventDefault();
        const value = form.querySelector('input[name="value"]').value;

        const formData = new FormData();
        formData.append('stat_type', stat);
        formData.append('value', value);

        const response = await fetch("/update_stat", {
            method: "POST",
            body: formData
        });

        const data = await response.json();
        if (data.success) {
            document.getElementById(stat.replace('_', '-')).innerText = data.new_value;
            form.style.display = 'none';
        } else {
            alert(data.error || "Failed to update stat");
        }
    }
}
</script>
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="">
</script>
<script>
// Initialize Leaflet map
const map = L.map('map').setView([28.6139, 77.2090], 13); // Example: Delhi coordinates

// Add OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Example markers
L.marker([28.6139, 77.2090]).addTo(map)
    .bindPopup('<strong>Safe Zone</strong><br>Main Street');

L.marker([28.6200, 77.2100]).addTo(map)
    .bindPopup('<strong>Alert Area</strong><br>Central Park');
</script>

</main>
</body>
</html>
